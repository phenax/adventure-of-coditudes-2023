âŸ¨ParseInt, IsDigit, TakeNat, EatSpaces, SplitâŸ© â† â€¢Import "../utils.bqn"

input â† â€¢FLines "./input.txt"

Parse â† {ğ•Š grid:
  numbers â‡ âŸ¨âŸ© â‹„ symbols â‡ âŸ¨âŸ©
  {ğ•Š âŸ¨line, rowâŸ©:
    n â† "" â‹„ start â† 0
    {ğ•Š âŸ¨char, colâŸ©:
      {
        1: startâ†© >âŸœ0âˆ˜â‰ â—¶âŸ¨col,startâŸ© n â‹„ nâˆ¾â†©âŸ¨charâŸ©;
        numbersâˆ¾â†© ({0:âŸ¨âŸ©; âŸ¨âŸ¨ParseInt n, row, start, colâŸ©âŸ©} â‰ n)
        nâ†©"" â‹„ startâ†©0
        { '.': @; symbolsâˆ¾â†©âŸ¨âŸ¨char, row, colâŸ©âŸ© } char
      } IsDigit char
    }Â¨ â‹ˆÂ¨âŸœâ†•âŸœâ‰  line
  }Â¨ â‹ˆÂ¨âŸœâ†•âŸœâ‰  âˆ¾âŸœ"."Â¨ grid
}

directions â† âŸ¨âŸ¨-1, -1âŸ©, âŸ¨-1, 0âŸ©, âŸ¨-1, 1âŸ©, âŸ¨0, -1âŸ©, âŸ¨0, 1âŸ©, âŸ¨1, -1âŸ©, âŸ¨1, 0âŸ©, âŸ¨1, 1âŸ©âŸ©
IsNearSym â† {âŸ¨num, nr, nstart, nendâŸ© ğ•Š symbols:
  âˆ¨Â´{ğ•ŠâŸ¨sym, sr, scâŸ©:
    âˆ¨Â´{ğ•Šn: âˆ¨Â´{ğ•Š âŸ¨r, câŸ©: âŸ¨r + nr, c + nâŸ© â‰¡ âŸ¨sr, scâŸ© }Â¨ directions }Â¨ nstart {ğ•¨+â†•ğ•©-ğ•¨} nend
  }Â¨symbols
}
NumNeighbors â† {sym ğ•Š numbers: IsNearSymâŸœâŸ¨symâŸ©Â¨âŠ¸/numbers}

Solve1 â† {ğ•Š r: +Â´âŠ‘Â¨IsNearSymâŸœr.symbolsÂ¨âŠ¸/ r.numbers} Parse
Solve2 â† {ğ•Š r: +Â´(Ã—Â´âŠ‘Â¨)Â¨=âŸœ2âˆ˜â‰ Â¨âŠ¸/ NumNeighborsâŸœr.numbersÂ¨ '*'âŠ¸=âˆ˜âŠ‘Â¨âŠ¸/r.symbols} Parse

âŸ¨s1, s2âŸ© â† âŸ¨Solve1 input, Solve2 inputâŸ©

â€¢Show "solution 1"â€¿s1
â€¢Show "solution 2"â€¿s2

# Tests
# ! 4361 â‰¡ s1
# ! 467835 â‰¡ s2
! 549908 â‰¡ s1
! 81166799 â‰¡ s2
